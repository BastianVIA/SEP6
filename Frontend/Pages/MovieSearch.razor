@page "/MovieSearch/{movieTitle}"
@using Frontend.Entities
@using Frontend.Model.MovieSearchModel
@inject IMovieSearchModel MovieSearchModel
@inject NavigationManager NavManager

<PageTitle>Movie Search</PageTitle>

<h3>Movie Search</h3>

 <form>
  <label>Movie name:</label><br>
     <input type="text" @bind="@movieTitle"/><br>
 </form> 
<button class="btn btn-primary" @onclick="SearchForMovie">Search Movie</button>

<table>
    <thead>
        <tr>
            <th>Poster</th>
            <th>Title</th>
            <th>ReleaseYear</th>
            <th>Rating</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var movie in movieList)
        {
            <tr @onclick="@(() => OnMovieClick(movie.Id))">
                <td><img src="@movie.PosterUrl" alt="Image" height="200" ></td>
                <td>@movie.Title</td>
                <td>@movie.ReleaseYear</td>
                <td>@movie.Rating.AverageRating</td>
            </tr>
        }
    </tbody>
</table>

@code {
    [Parameter]
    public string MovieTitle { get; set; }
    private IList<Movie> movieList = new List<Movie>();
    private string movieTitle { get; set; }

    protected override async void OnParametersSet()
    {
        movieTitle = MovieTitle;
    }
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await SearchForMovie();
            StateHasChanged(); 
        }
    }

    private async Task SearchForMovie()
    {
        movieList.Clear();
        movieList = await MovieSearchModel.SearchForMovieAsync(movieTitle);
    }

    private void OnMovieClick(string movieId)
    {
        NavManager.NavigateTo($"movieDetails/{movieId}");
    }

}
